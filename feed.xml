<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="https://vveicc.github.io/blog/feed.xml" rel="self" type="application/atom+xml" /><link href="https://vveicc.github.io/blog/" rel="alternate" type="text/html" /><updated>2023-12-02T02:35:21+00:00</updated><id>https://vveicc.github.io/blog/feed.xml</id><title type="html">vveicc’s blog</title><subtitle>因为热爱 所以坚持</subtitle><entry><title type="html">Mac基于Docker搭建Hadoop集群</title><link href="https://vveicc.github.io/blog/mac_docker_hadoop" rel="alternate" type="text/html" title="Mac基于Docker搭建Hadoop集群" /><published>2023-08-02T00:00:00+00:00</published><updated>2023-08-02T00:00:00+00:00</updated><id>https://vveicc.github.io/blog/mac_docker_hadoop</id><content type="html" xml:base="https://vveicc.github.io/blog/mac_docker_hadoop"><![CDATA[<p>在Mac宿主机基于Docker搭建Hadoop分布式集群，仅供学习。</p>
<!-- more -->
<hr />
<p><strong>运行环境</strong>：</p>
<ul>
<li>Intel处理器</li>
<li>macOS 13.5</li>
<li>Docker Engine v24.0.2</li>
<li>Docker Compose v2.19.1</li>
<li>Hadoop 3.3.6</li>
</ul>
<h2 id="section">集群规划</h2>
<table>
<thead>
<tr>
<th></th>
<th align="left">hadoop02</th>
<th align="left">hadoop03</th>
<th align="left">hadoop04</th>
</tr>
</thead>
<tbody>
<tr>
<td>HDFS</td>
<td align="left">NameNode<br/>DataNode</td>
<td align="left"><br/>DataNode</td>
<td align="left">SecondaryNameNode<br/>DataNode</td>
</tr>
<tr>
<td>Yarn</td>
<td align="left"><br/>NodeManager</td>
<td align="left">ResourceManager<br/>NodeManager</td>
<td align="left"><br/>NodeManager</td>
</tr>
<tr>
<td>MapReduce</td>
<td align="left">JobHistoryServer</td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<h2 id="section-1">准备配置文件</h2>
<div id="code_copied_snackbar">Copied!</div><ul class="code-tab-container 4874055a-fc62-4fa4-970f-66dcf81fd5d4"><li class="active-tab code_switcher_text"><a onclick="selectTab('code_switcher_text', '4874055a-fc62-4fa4-970f-66dcf81fd5d4', 0)">workers</a></li><li class=" code_switcher_xml"><a onclick="selectTab('code_switcher_xml', '4874055a-fc62-4fa4-970f-66dcf81fd5d4', 1)">core-site.xml</a></li><li class=" code_switcher_xml"><a onclick="selectTab('code_switcher_xml', '4874055a-fc62-4fa4-970f-66dcf81fd5d4', 2)">hdfs-site.xml</a></li><li class=" code_switcher_xml"><a onclick="selectTab('code_switcher_xml', '4874055a-fc62-4fa4-970f-66dcf81fd5d4', 3)">mapred-site.xml</a></li><li class=" code_switcher_xml"><a onclick="selectTab('code_switcher_xml', '4874055a-fc62-4fa4-970f-66dcf81fd5d4', 4)">yarn-site.xml</a></li></ul><ul class="code-tab-switcher 4874055a-fc62-4fa4-970f-66dcf81fd5d4"><li class="code_switcher_container_parent active-tab code_switcher_text ed3056ec-4073-4a0f-9156-77cd99300d9d"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('ed3056ec-4073-4a0f-9156-77cd99300d9d', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hadoop02
hadoop03
hadoop04
</code></pre></div></div>
</li><li class="code_switcher_container_parent code_switcher_xml b7b703ec-d03f-4558-bf35-b71bf9bc465b"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('b7b703ec-d03f-4558-bf35-b71bf9bc465b', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span>
<span class="c">&lt;!--
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. See accompanying LICENSE file.
--&gt;</span>

<span class="c">&lt;!-- Put site-specific property overrides in this file. --&gt;</span>

<span class="nt">&lt;configuration&gt;</span>
	<span class="c">&lt;!-- 指定 NameNode 的地址 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>fs.defaultFS<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>hdfs://hadoop02:8020<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- 指定 hadoop 数据的存储目录 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>hadoop.tmp.dir<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>/opt/hadoop/data<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- 配置 HDFS 网页登录使用的静态用户 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>hadoop.http.staticuser.user<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>root<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>

	<span class="c">&lt;!-- 开启回收站功能，并设置回收站中文件存活时间为60分钟 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>fs.trash.interval<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>60<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div></div>
</li><li class="code_switcher_container_parent code_switcher_xml b907cd02-8703-4273-845e-0716bac65b4b"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('b907cd02-8703-4273-845e-0716bac65b4b', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span>
<span class="c">&lt;!--
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. See accompanying LICENSE file.
--&gt;</span>

<span class="c">&lt;!-- Put site-specific property overrides in this file. --&gt;</span>

<span class="nt">&lt;configuration&gt;</span>
	<span class="c">&lt;!-- nn web 端访问地址--&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>dfs.namenode.http-address<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>hadoop02:9870<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- 2nn web 端访问地址--&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>dfs.namenode.secondary.http-address<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>hadoop04:9868<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>

	<span class="c">&lt;!-- nn 工作线程池并发配置 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>dfs.namenode.handler.count<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>21<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div></div>
</li><li class="code_switcher_container_parent code_switcher_xml e7ab7bac-5868-4e14-b7dd-d0b8082cf717"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('e7ab7bac-5868-4e14-b7dd-d0b8082cf717', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="cp">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span>
<span class="c">&lt;!--
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. See accompanying LICENSE file.
--&gt;</span>

<span class="c">&lt;!-- Put site-specific property overrides in this file. --&gt;</span>

<span class="nt">&lt;configuration&gt;</span>
	<span class="c">&lt;!-- 指定 mapreduce 程序运行在 yarn 上 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>mapreduce.framework.name<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>yarn<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- 历史服务器端地址 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>mapreduce.jobhistory.address<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>hadoop02:10020<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- 历史服务器 web 端地址 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>mapreduce.jobhistory.webapp.address<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>hadoop02:19888<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div></div>
</li><li class="code_switcher_container_parent code_switcher_xml 3168d74e-d84b-4516-9d36-da84c5b6eaa1"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('3168d74e-d84b-4516-9d36-da84c5b6eaa1', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="c">&lt;!--
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. See accompanying LICENSE file.
--&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
	<span class="c">&lt;!-- 指定 mapreduce 走 shuffle --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>yarn.nodemanager.aux-services<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>mapreduce_shuffle<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- 指定 ResourceManager 的地址--&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>yarn.resourcemanager.hostname<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>hadoop03<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- 环境变量的继承 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>yarn.nodemanager.env-whitelist<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- 开启日志聚集功能 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>yarn.log-aggregation-enable<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>true<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- 设置日志聚集服务器地址 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>yarn.log.server.url<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>http://hadoop02:19888/jobhistory/logs<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- 设置日志保留时间为 7 天 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>yarn.log-aggregation.retain-seconds<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>604800<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>

	<span class="c">&lt;!-- 选择调度器，默认容量调度器 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>yarn.resourcemanager.scheduler.class<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- ResourceManager 处理调度器请求的线程数量，默认 50 --&gt;</span>
	<span class="c">&lt;!-- 如果提交的任务数大于 50，可以增加该值，但是不能超过 3 台 * 4 线程 = 12 线程(去除其他应用程序实际不能超过 8) --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>yarn.resourcemanager.scheduler.client.thread-count<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>8<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- 是否让 yarn 自动检测硬件进行配置，默认是 false --&gt;</span>
	<span class="c">&lt;!-- 如果该节点有很多其他应用程序，建议手动配置；如果该节点没有其他应用程序，可以采用自动 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>yarn.nodemanager.resource.detect-hardware-capabilities<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>false<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- 是否将虚拟核数当作 CPU 核数，默认是 false，采用物理 CPU 核数 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>yarn.nodemanager.resource.count-logical-processors-as-cores<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>false<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- 虚拟核数和物理核数乘数，默认是 1.0 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>yarn.nodemanager.resource.pcores-vcores-multiplier<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>1.0<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- NodeManager 使用内存数，默认 8G，修改为 4G 内存 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>yarn.nodemanager.resource.memory-mb<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>4096<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- NodeManager 的 CPU 核数，不按照硬件环境自动设定时默认是 8 个，修改为 4 个 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>yarn.nodemanager.resource.cpu-vcores<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>4<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- 容器最小内存，默认 1G --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>yarn.scheduler.minimum-allocation-mb<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>1024<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- 容器最大内存，默认 8G，修改为 2G --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>yarn.scheduler.maximum-allocation-mb<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>2048<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- 容器最小 CPU 核数，默认 1 个 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>yarn.scheduler.minimum-allocation-vcores<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>1<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- 容器最大 CPU 核数，默认 4 个，修改为 2 个 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>yarn.scheduler.maximum-allocation-vcores<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>2<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- 虚拟内存检查，默认打开，修改为关闭 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>false<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- 虚拟内存和物理内存设置比例，默认 2.1 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>yarn.nodemanager.vmem-pmem-ratio<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>2.1<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>

	<span class="c">&lt;!-- 开启 uber 模式，优化小文件计算，默认关闭 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>mapreduce.job.ubertask.enable<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>true<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- uber 模式中最大的 map 数量，仅可向下修改 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>mapreduce.job.ubertask.maxmaps<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>9<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- uber 模式中最大的 reduce 数量，仅可向下修改 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>mapreduce.job.ubertask.maxreduces<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;</span>1<span class="nt">&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
	<span class="c">&lt;!-- uber 模式中最大的输入数据量，默认使用 dfs.blocksize 的值，仅可向下修改 --&gt;</span>
	<span class="nt">&lt;property&gt;</span>
		<span class="nt">&lt;name&gt;</span>mapreduce.job.ubertask.maxbytes<span class="nt">&lt;/name&gt;</span>
		<span class="nt">&lt;value&gt;&lt;/value&gt;</span>
	<span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div></div>
</li></ul>
<h2 id="section-2">编写工具脚本</h2>
<ul class="code-tab-container 0575e81b-1258-4de0-8fdc-4705ab6cbda4"><li class="active-tab code_switcher_shell"><a onclick="selectTab('code_switcher_shell', '0575e81b-1258-4de0-8fdc-4705ab6cbda4', 0)">jpsall</a></li><li class=" code_switcher_shell"><a onclick="selectTab('code_switcher_shell', '0575e81b-1258-4de0-8fdc-4705ab6cbda4', 1)">ihadoop.sh</a></li></ul><ul class="code-tab-switcher 0575e81b-1258-4de0-8fdc-4705ab6cbda4"><li class="code_switcher_container_parent active-tab code_switcher_shell 6e05c352-bdca-4433-a91a-d9d1b7952950"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('6e05c352-bdca-4433-a91a-d9d1b7952950', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="k">for </span>host <span class="k">in </span>hadoop02 hadoop03 hadoop04
<span class="k">do
	</span><span class="nb">echo</span> <span class="s2">"&gt; </span><span class="nv">$host</span><span class="s2">"</span>
	ssh <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no <span class="nv">$host</span> <span class="nv">$JAVA_HOME</span>/bin/jps
<span class="k">done</span>
</code></pre></div></div>
</li><li class="code_switcher_container_parent code_switcher_shell 3eea0133-5bcc-4b86-8f25-e103b0efe157"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('3eea0133-5bcc-4b86-8f25-e103b0efe157', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="nv">usage</span><span class="o">=</span><span class="s2">"Usage: ihadoop.sh (start|stop|restart|cleanup|format)"</span>

<span class="c"># 检查参数个数</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$# </span><span class="nt">-ne</span> 1 <span class="o">]</span>
<span class="k">then
	</span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"Error: 请输入一个参数!</span><span class="se">\n</span><span class="nv">$usage</span><span class="s2">"</span>
	<span class="nb">exit
</span><span class="k">fi

function </span>stop<span class="o">()</span>
<span class="o">{</span>
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"&gt; 关闭 hadoop 集群..."</span>
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"&gt; stop historyserver..."</span>
	ssh <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no hadoop02 <span class="s2">"</span><span class="nv">$HADOOP_HOME</span><span class="s2">/bin/mapred --daemon stop historyserver"</span>
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"&gt; stop yarn..."</span>
	ssh <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no hadoop03 <span class="s2">"</span><span class="nv">$HADOOP_HOME</span><span class="s2">/sbin/stop-yarn.sh"</span>
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"&gt; stop dfs..."</span>
	ssh <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no hadoop02 <span class="s2">"</span><span class="nv">$HADOOP_HOME</span><span class="s2">/sbin/stop-dfs.sh"</span>
<span class="o">}</span>

<span class="k">function </span>start<span class="o">()</span>
<span class="o">{</span>
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"&gt; 启动 hadoop 集群..."</span>
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"&gt; start dfs..."</span>
	ssh <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no hadoop02 <span class="s2">"</span><span class="nv">$HADOOP_HOME</span><span class="s2">/sbin/start-dfs.sh"</span>
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"&gt; start yarn..."</span>
	ssh <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no hadoop03 <span class="s2">"</span><span class="nv">$HADOOP_HOME</span><span class="s2">/sbin/start-yarn.sh"</span>
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"&gt; start historyserver..."</span>
	ssh <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no hadoop02 <span class="s2">"</span><span class="nv">$HADOOP_HOME</span><span class="s2">/bin/mapred --daemon start historyserver"</span>
<span class="o">}</span>

<span class="k">function </span>cleanup<span class="o">()</span>
<span class="o">{</span>
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"&gt; 清理 data 和 logs 目录..."</span>
	<span class="k">for </span>host <span class="k">in </span>hadoop02 hadoop03 hadoop04
	<span class="k">do
		</span><span class="nb">echo</span> <span class="s2">"&gt; 清理 </span><span class="nv">$host</span><span class="s2">..."</span>
		ssh <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no <span class="nv">$host</span> <span class="s2">"rm -rf </span><span class="nv">$HADOOP_HOME</span><span class="s2">/data/* </span><span class="nv">$HADOOP_HOME</span><span class="s2">/logs/*"</span>
	<span class="k">done</span>
<span class="o">}</span>

<span class="k">function </span>format<span class="o">()</span>
<span class="o">{</span>
	ssh <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no hadoop02 <span class="s2">"</span><span class="nv">$HADOOP_HOME</span><span class="s2">/bin/hdfs namenode -format"</span>
<span class="o">}</span>

<span class="k">function </span>sleep3s<span class="o">()</span>
<span class="o">{</span>
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"&gt; sleep 3s..."</span>
	<span class="nb">sleep </span>3s
<span class="o">}</span>

<span class="k">case</span> <span class="nv">$1</span> <span class="k">in</span>
<span class="s2">"stop"</span><span class="p">)</span>
	stop
<span class="p">;;</span>
<span class="s2">"start"</span><span class="p">)</span>
	start
<span class="p">;;</span>
<span class="s2">"restart"</span><span class="p">)</span>
	stop <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="o">&amp;&amp;</span> sleep3s <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="o">&amp;&amp;</span> start
<span class="p">;;</span>
<span class="s2">"cleanup"</span><span class="p">)</span>
	cleanup
<span class="p">;;</span>
<span class="s2">"format"</span><span class="p">)</span>
	cleanup <span class="o">&amp;&amp;</span> format
<span class="p">;;</span>
<span class="k">*</span><span class="p">)</span>
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"Error: 请输入正确的参数!</span><span class="se">\n</span><span class="nv">$usage</span><span class="s2">"</span>
<span class="p">;;</span>
<span class="k">esac</span>
</code></pre></div></div>
</li></ul>
<h2 id="dockerfile">Dockerfile</h2>
<p>基于 <a href="https://github.com/bitnami/containers/blob/main/bitnami/java/1.8/debian-11/Dockerfile">bitnami/java:1.8</a> 构建Docker镜像。</p>
<ul class="code-tab-container 72391d8d-5ab9-4561-9551-8d5dd6aabf47"><li class="active-tab code_switcher_dockerfile"><a onclick="selectTab('code_switcher_dockerfile', '72391d8d-5ab9-4561-9551-8d5dd6aabf47', 0)">Dockerfile</a></li></ul><ul class="code-tab-switcher 72391d8d-5ab9-4561-9551-8d5dd6aabf47"><li class="code_switcher_container_parent active-tab code_switcher_dockerfile ba1b031b-25d3-4ab6-bc2f-0653eff4fde0"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('ba1b031b-25d3-4ab6-bc2f-0653eff4fde0', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> bitnami/java:1.8</span>
<span class="k">MAINTAINER</span><span class="s"> vveicc</span>

<span class="k">ARG</span><span class="s"> HADOOP_VERSION=3.3.6</span>

<span class="k">WORKDIR</span><span class="s"> /root</span>

<span class="k">ENV</span><span class="s"> HADOOP_HOME /opt/hadoop</span>

<span class="k">RUN </span><span class="nb">echo</span> <span class="s2">"==&gt; install ssh..."</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">sed</span> <span class="nt">-i</span> s@/deb.debian.org/@/mirrors.aliyun.com/@g /etc/apt/sources.list <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">sed</span> <span class="nt">-i</span> s@/security.debian.org/@/mirrors.aliyun.com/debian-security@g /etc/apt/sources.list <span class="o">&amp;&amp;</span> <span class="se">\
</span>    apt-get update <span class="o">&amp;&amp;</span> <span class="se">\
</span>    apt-get upgrade <span class="nt">-y</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>    apt-get <span class="nb">install</span> <span class="nt">-y</span> <span class="nt">--no-install-recommends</span> ssh <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"==&gt; setup ssh..."</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">/etc/init.d/ssh start &gt;&gt; /dev/null"</span> <span class="o">&gt;&gt;</span> ~/.bashrc <span class="o">&amp;&amp;</span> <span class="se">\
</span>    ssh-keygen <span class="nt">-t</span> rsa <span class="nt">-P</span> <span class="s1">''</span> <span class="nt">-f</span> ~/.ssh/id_rsa <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">cat</span> ~/.ssh/id_rsa.pub <span class="o">&gt;&gt;</span> ~/.ssh/authorized_keys <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">chmod </span>0600 ~/.ssh/authorized_keys <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"==&gt; download hadoop..."</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$HADOOP_HOME</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>    wget <span class="nt">--no-check-certificate</span> https://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-<span class="nv">$HADOOP_VERSION</span>/hadoop-<span class="nv">$HADOOP_VERSION</span>.tar.gz <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">tar</span> <span class="nt">-zxf</span> hadoop-<span class="nv">$HADOOP_VERSION</span>.tar.gz <span class="nt">--strip-components</span> 1 <span class="nt">-C</span> <span class="nv">$HADOOP_HOME</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"==&gt; download configuration &amp; scripts..."</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>    wget https://vveicc.github.io/blog/files/docker/hadoop/hadoop.tar.gz <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">tar</span> <span class="nt">-zxf</span> hadoop.tar.gz <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">mv </span>etc/hadoop/<span class="k">*</span> <span class="nv">$HADOOP_HOME</span>/etc/hadoop/ <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">mv </span>scripts/<span class="k">*</span> /usr/local/bin/ <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"==&gt; setup env..."</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"export JAVA_HOME=</span><span class="nv">$JAVA_HOME</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /etc/profile.d/iprofile.sh <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"export HADOOP_HOME=</span><span class="nv">$HADOOP_HOME</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /etc/profile.d/iprofile.sh <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"export PATH=</span><span class="se">\$</span><span class="s2">PATH:</span><span class="se">\$</span><span class="s2">JAVA_HOME/bin:</span><span class="se">\$</span><span class="s2">HADOOP_HOME/bin:</span><span class="se">\$</span><span class="s2">HADOOP_HOME/sbin"</span> <span class="o">&gt;&gt;</span> /etc/profile.d/iprofile.sh <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">if [ -f /etc/profile ]; then</span><span class="se">\n\t</span><span class="s2">. /etc/profile</span><span class="se">\n</span><span class="s2">fi"</span> <span class="o">&gt;&gt;</span> ~/.bashrc <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">export SHELL=/bin/bash"</span> <span class="o">&gt;&gt;</span> ~/.bashrc <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">export LS_OPTIONS='--color=auto'"</span> <span class="o">&gt;&gt;</span> ~/.bashrc <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"eval </span><span class="se">\"\`</span><span class="s2">dircolors</span><span class="se">\`\"</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> ~/.bashrc <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"alias ls='ls </span><span class="se">\$</span><span class="s2">LS_OPTIONS'"</span> <span class="o">&gt;&gt;</span> ~/.bashrc <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"alias ll='ls </span><span class="se">\$</span><span class="s2">LS_OPTIONS -lA'"</span> <span class="o">&gt;&gt;</span> ~/.bashrc <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"==&gt; setup hadoop env..."</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"export HDFS_NAMENODE_OPTS=</span><span class="se">\"</span><span class="s2">-Dhadoop.security.logger=INFO,RFAS -Xmx1024m</span><span class="se">\"</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="nv">$HADOOP_HOME</span>/etc/hadoop/hadoop-env.sh <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"export HDFS_DATANODE_OPTS=</span><span class="se">\"</span><span class="s2">-Dhadoop.security.logger=ERROR,RFAS -Xmx1024m</span><span class="se">\"</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="nv">$HADOOP_HOME</span>/etc/hadoop/hadoop-env.sh <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"export JAVA_HOME=</span><span class="nv">$JAVA_HOME</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="nv">$HADOOP_HOME</span>/etc/hadoop/hadoop-env.sh <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"export HADOOP_MAPRED_HOME=</span><span class="nv">$HADOOP_HOME</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="nv">$HADOOP_HOME</span>/etc/hadoop/hadoop-env.sh <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"export HDFS_NAMENODE_USER=root"</span> <span class="o">&gt;&gt;</span> <span class="nv">$HADOOP_HOME</span>/etc/hadoop/hadoop-env.sh <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"export HDFS_DATANODE_USER=root"</span> <span class="o">&gt;&gt;</span> <span class="nv">$HADOOP_HOME</span>/etc/hadoop/hadoop-env.sh <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"export HDFS_SECONDARYNAMENODE_USER=root"</span> <span class="o">&gt;&gt;</span> <span class="nv">$HADOOP_HOME</span>/etc/hadoop/hadoop-env.sh <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"export YARN_RESOURCEMANAGER_USER=root"</span> <span class="o">&gt;&gt;</span> <span class="nv">$HADOOP_HOME</span>/etc/hadoop/hadoop-env.sh <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"export YARN_NODEMANAGER_USER=root"</span> <span class="o">&gt;&gt;</span> <span class="nv">$HADOOP_HOME</span>/etc/hadoop/hadoop-env.sh <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="se">\
</span>    <span class="nb">echo</span> <span class="s2">"==&gt; clean up..."</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>    apt-get clean <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/apt/lists /var/cache/apt/archives <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">rm</span> <span class="nt">-rf</span> hadoop-<span class="nv">$HADOOP_VERSION</span>.tar.gz hadoop.tar.gz etc scripts

<span class="k">CMD</span><span class="s"> ["/bin/bash"]</span>

<span class="c"># NameNode WEB UI 端口</span>
<span class="k">EXPOSE</span><span class="s"> 9870</span>
<span class="c"># DataNode WEB UI 端口</span>
<span class="k">EXPOSE</span><span class="s"> 9864</span>
<span class="c"># SecondaryNameNode WEB UI 端口</span>
<span class="k">EXPOSE</span><span class="s"> 9868</span>
<span class="c"># 历史服务器 WEB UI 端口</span>
<span class="k">EXPOSE</span><span class="s"> 19888</span>
<span class="c"># Yarn WEB UI 端口</span>
<span class="k">EXPOSE</span><span class="s"> 8088</span>
</code></pre></div></div>
</li></ul>
<h2 id="docker-composeyaml">docker-compose.yaml</h2>
<p>使用静态IP，便于在宿主机访问容器，如果子网IP如有冲突，需要更改为未占用的IP。</p>
<ul class="code-tab-container bc50abab-9603-4be4-8c69-5fed525f1ac1"><li class="active-tab code_switcher_yaml"><a onclick="selectTab('code_switcher_yaml', 'bc50abab-9603-4be4-8c69-5fed525f1ac1', 0)">docker-compose.yaml</a></li></ul><ul class="code-tab-switcher bc50abab-9603-4be4-8c69-5fed525f1ac1"><li class="code_switcher_container_parent active-tab code_switcher_yaml 3679c222-9656-4609-a36d-366e6cf97ba7"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('3679c222-9656-4609-a36d-366e6cf97ba7', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.1"</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">cluster</span><span class="pi">:</span>
    <span class="na">ipam</span><span class="pi">:</span>
      <span class="na">driver</span><span class="pi">:</span> <span class="s">default</span>
      <span class="na">config</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">subnet</span><span class="pi">:</span> <span class="s2">"</span><span class="s">172.18.0.0/28"</span>
          <span class="na">gateway</span><span class="pi">:</span> <span class="s2">"</span><span class="s">172.18.0.1"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">hadoop02</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">vveicc/hadoop:3.3.6</span>
    <span class="na">hostname</span><span class="pi">:</span> <span class="s">hadoop02</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">hadoop02</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">stdin_open</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">tty</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="na">cluster</span><span class="pi">:</span>
        <span class="na">ipv4_address</span><span class="pi">:</span> <span class="s">172.18.0.2</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./hadoop02/hadoop/data:/opt/hadoop/data</span>
      <span class="pi">-</span> <span class="s">./hadoop02/hadoop/logs:/opt/hadoop/logs</span>

  <span class="na">hadoop03</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">vveicc/hadoop:3.3.6</span>
    <span class="na">hostname</span><span class="pi">:</span> <span class="s">hadoop03</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">hadoop03</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">stdin_open</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">tty</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="na">cluster</span><span class="pi">:</span>
        <span class="na">ipv4_address</span><span class="pi">:</span> <span class="s">172.18.0.3</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./hadoop03/hadoop/data:/opt/hadoop/data</span>
      <span class="pi">-</span> <span class="s">./hadoop03/hadoop/logs:/opt/hadoop/logs</span>

  <span class="na">hadoop04</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">vveicc/hadoop:3.3.6</span>
    <span class="na">hostname</span><span class="pi">:</span> <span class="s">hadoop04</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">hadoop04</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">stdin_open</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">tty</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="na">cluster</span><span class="pi">:</span>
        <span class="na">ipv4_address</span><span class="pi">:</span> <span class="s">172.18.0.4</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./hadoop04/hadoop/data:/opt/hadoop/data</span>
      <span class="pi">-</span> <span class="s">./hadoop04/hadoop/logs:/opt/hadoop/logs</span>
</code></pre></div></div>
</li></ul>
<h2 id="section-3">快速部署脚本</h2>
<p>编写快速部署脚本：</p>
<ul class="code-tab-container 9603113d-7db0-4697-be88-f28d1f9448cb"><li class="active-tab code_switcher_shell"><a onclick="selectTab('code_switcher_shell', '9603113d-7db0-4697-be88-f28d1f9448cb', 0)">hadoop-init.sh</a></li></ul><ul class="code-tab-switcher 9603113d-7db0-4697-be88-f28d1f9448cb"><li class="code_switcher_container_parent active-tab code_switcher_shell 257c306e-1d5f-44a4-abe4-18e993e4fc4d"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('257c306e-1d5f-44a4-abe4-18e993e4fc4d', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="si">$(</span>which wget<span class="si">)</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"Error: wget not installed"</span>
  <span class="nb">exit
</span><span class="k">fi</span>

<span class="c"># 在当前目录下创建hadoop文件夹作为工作目录</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> hadoop

<span class="nb">cd </span>hadoop
wget https://vveicc.github.io/blog/files/docker/hadoop/Dockerfile
wget https://vveicc.github.io/blog/files/docker/hadoop/docker-compose.yaml

<span class="nb">echo</span> <span class="s2">"&gt; 构建镜像..."</span>
docker build <span class="nt">-t</span> vveicc/hadoop:3.3.6 <span class="nb">.</span>

<span class="nb">echo</span> <span class="s2">"&gt; 创建宿主机数据卷目录..."</span>
<span class="k">for </span>host <span class="k">in </span>hadoop02 hadoop03 hadoop04
<span class="k">do
       </span><span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$host</span>/hadoop/data
       <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$host</span>/hadoop/logs
<span class="k">done

</span><span class="nb">echo</span> <span class="s2">"&gt; 运行容器实例..."</span>
docker compose up <span class="nt">-d</span>
</code></pre></div></div>
</li></ul>
<p>在 Mac 上通过脚本快速部署：</p>
<div class="code_switcher_container_parent b8dc734a-e2dd-4e6e-8938-5c5e4839a26c"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('b8dc734a-e2dd-4e6e-8938-5c5e4839a26c', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://vveicc.github.io/blog/files/docker/hadoop/hadoop-init.sh
bash hadoop-init.sh
</code></pre></div></div>
</div>
<h2 id="hadoop">启动Hadoop集群</h2>
<p>查看 Docker 容器：</p>
<div class="code_switcher_container_parent dea57ee0-31d6-4bdb-85fe-bfe9b0b702c6"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('dea57ee0-31d6-4bdb-85fe-bfe9b0b702c6', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>hadoop
docker compose ps
</code></pre></div></div>
</div>
<p>进入 Docker 容器：</p>
<div class="code_switcher_container_parent 934ca5a8-7a6f-40f6-9919-c0b7421ac995"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('934ca5a8-7a6f-40f6-9919-c0b7421ac995', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nb">exec</span> <span class="nt">-it</span> hadoop02 bash
</code></pre></div></div>
</div>
<p>第一次启动集群需要先格式化 NameNode ：</p>
<div class="code_switcher_container_parent f4480583-85df-4229-8a61-7858d8beac6c"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('f4480583-85df-4229-8a61-7858d8beac6c', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@hadoop02:~# ihadoop.sh format
</code></pre></div></div>
</div>
<p>启动 Hadoop 集群：</p>
<div class="code_switcher_container_parent 39d3a99e-f3cf-4b9d-82d3-e170b0471b39"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('39d3a99e-f3cf-4b9d-82d3-e170b0471b39', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@hadoop02:~# ihadoop.sh start
</code></pre></div></div>
</div>
<p>查看集群 Java 进程：</p>
<div class="code_switcher_container_parent 61b91888-6549-4f28-b825-11e42116449e"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('61b91888-6549-4f28-b825-11e42116449e', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@hadoop02:~# jpsall
</code></pre></div></div>
</div>
<p>如果看到的进程信息与 <a href="#%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92">集群规划</a> 一致，说明 Hadoop 集群启动成功。</p>
<p>运行 <code>WordCount</code> 示例程序，测试验证集群是否正常：</p>
<div class="code_switcher_container_parent efeb4dc3-7517-478f-9359-881e98f85457"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('efeb4dc3-7517-478f-9359-881e98f85457', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@hadoop02:~# hdfs dfs <span class="nt">-mkdir</span> /input
root@hadoop02:~# hdfs dfs <span class="nt">-put</span> <span class="nv">$HADOOP_HOME</span>/README.txt /input/
root@hadoop02:~# hdfs dfs <span class="nt">-ls</span> /input
root@hadoop02:~# hadoop jar <span class="nv">$HADOOP_HOME</span>/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.6.jar wordcount /input /output
</code></pre></div></div>
</div>
<h2 id="mac">Mac宿主机访问集群</h2>
<p><code>Docker Desktop for Mac</code> 没有提供从宿主的macOS通过容器IP访问容器的方式。</p>
<p>需要通过 <a href="https://github.com/wenjunxiao/mac-docker-connector">mac-docker-connector</a> 将Mac宿主机与Docker容器网络打通。</p>
<p>如果在网络打通过程中遇到问题，可以参考 <a href="mac_docker_connector">Mac宿主机与Docker容器网络打通</a> 解决。</p>
<p>网络打通后，在 <code>/etc/hosts</code> 文件中添加域名IP映射：</p>
<div class="code_switcher_container_parent 3c7a8bee-0c21-43be-baf4-5eed187d19c4"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('3c7a8bee-0c21-43be-baf4-5eed187d19c4', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>172.18.0.2 hadoop02
172.18.0.3 hadoop03
172.18.0.4 hadoop04
</code></pre></div></div>
</div>
<p>在宿主机访问 HDFS：<a href="http://hadoop02:9870">hadoop02:9870</a></p>
<p>在宿主机访问 Yarn：<a href="http://hadoop03:8088">hadoop03:8088</a></p>]]></content><author><name>vveicc</name></author><category term="Docker" /><category term="Hadoop" /><summary type="html"><![CDATA[在Mac宿主机基于Docker搭建Hadoop分布式集群，仅供学习。]]></summary></entry><entry><title type="html">Mac宿主机与Docker容器网络打通</title><link href="https://vveicc.github.io/blog/mac_docker_connector" rel="alternate" type="text/html" title="Mac宿主机与Docker容器网络打通" /><published>2023-07-30T00:00:00+00:00</published><updated>2023-07-30T00:00:00+00:00</updated><id>https://vveicc.github.io/blog/mac_docker_connector</id><content type="html" xml:base="https://vveicc.github.io/blog/mac_docker_connector"><![CDATA[<p>Docker Desktop for Mac 没有提供从宿主的macOS通过容器IP访问容器的方式。</p>
<p>通过 <a href="https://github.com/wenjunxiao/mac-docker-connector">mac-docker-connector</a> 可以将Mac宿主机与Docker容器网络打通，在此记录一下使用过程中遇到的问题。</p>
<!-- more -->
<hr />
<p><strong>运行环境</strong>：</p>
<ul>
<li>Intel处理器</li>
<li>macOS 13.5</li>
<li>Docker Engine v24.0.2</li>
</ul>
<h2 id="dockermac-docker-connector">Docker端mac-docker-connector容器一直在重启</h2>
<p>通过 <code>docker logs CONTAINER</code> 命令查看容器日志，发现报错信息：</p>
<div id="code_copied_snackbar">Copied!</div><div class="code_switcher_container_parent c7f53be7-c9f1-4960-8d82-f94917ef77ec"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('c7f53be7-c9f1-4960-8d82-f94917ef77ec', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>invalid address =&gt; host.docker.internal:2511
</code></pre></div></div>
</div>
<p>通过在运行容器的命令中增加 <code>--add-host=host.docker.internal:host-gateway</code> 选项解决：</p>
<div class="code_switcher_container_parent 7de9f004-12e5-463d-b216-dbff5b493688"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('7de9f004-12e5-463d-b216-dbff5b493688', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">-d</span> <span class="nt">--restart</span> always <span class="se">\</span>
    <span class="nt">--net</span> host <span class="nt">--cap-add</span> NET_ADMIN <span class="se">\</span>
    <span class="nt">--add-host</span><span class="o">=</span>host.docker.internal:host-gateway <span class="se">\</span>
    <span class="nt">--name</span> mac-connector wenjunxiao/mac-docker-connector
</code></pre></div></div>
</div>
<h2 id="macdocker-connectorconfping">Mac端docker-connector.conf配置不生效，容器ping不通</h2>
<p>通过命令找到启动 <code>docker-connector</code> 后台服务的plist文件：</p>
<div class="code_switcher_container_parent b3a3d668-2103-44d4-a107-8e607023aaea"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('b3a3d668-2103-44d4-a107-8e607023aaea', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>brew services list | <span class="nb">grep </span>docker-connector
</code></pre></div></div>
</div>
<p><img src="images/docker/mac_docker_connector/brew_list_connector.png" alt="brew_list_connector" /></p>
<p>查看plist文件：</p>
<p><img src="images/docker/mac_docker_connector/cat_plist_file.png" alt="cat_plist_file" /></p>
<p>从plist文件中可以得到两个信息：</p>
<ol>
<li>启动命令：<code>sudo /usr/local/opt/docker-connector/bin/docker-connector -config etc/docker-connector.conf</code></li>
<li>日志文件：<code>/usr/local/var/log/docker-connector.log</code></li>
</ol>
<p>查看日志文件：</p>
<p><img src="images/docker/mac_docker_connector/docker_connector_log.png" alt="docker_connector_log" /></p>
<p>这个日志文件并不是之前配置的日志文件 <code>/usr/local/etc/docker-connector.conf</code>。</p>
<p>其实从启动命令中也可以看出这个问题，启动命令中的 <code>-config</code> 参数传入的配置文件是相对路径，也即是相对 <code>docker-connector</code> 所在的 <code>/usr/local/opt/docker-connector/bin/</code> 目录。</p>
<p>找到问题之后，解决问题就比较简单了，进入 <code>docker-connector</code> 的安装目录 <code>/usr/local/opt/docker-connector</code>，修改 <code>homebrew.mxcl.docker-connector.plist</code> 中的配置文件路径即可。</p>]]></content><author><name>vveicc</name></author><category term="Docker" /><category term="Mac" /><summary type="html"><![CDATA[Docker Desktop for Mac 没有提供从宿主的macOS通过容器IP访问容器的方式。 通过 mac-docker-connector 可以将Mac宿主机与Docker容器网络打通，在此记录一下使用过程中遇到的问题。]]></summary></entry><entry><title type="html">使用Docker运行MySQL 8.0</title><link href="https://vveicc.github.io/blog/docker_run_mysql" rel="alternate" type="text/html" title="使用Docker运行MySQL 8.0" /><published>2023-07-23T00:00:00+00:00</published><updated>2023-07-23T00:00:00+00:00</updated><id>https://vveicc.github.io/blog/docker_run_mysql</id><content type="html" xml:base="https://vveicc.github.io/blog/docker_run_mysql"><![CDATA[<p>使用 Docker 分别以 <strong>单机模式</strong> 和 <strong>主从模式</strong> 运行 MySQL 8.0。</p>
<!-- more -->
<h1 id="section">单机模式</h1>
<h3 id="section-1">运行容器实例</h3>
<div id="code_copied_snackbar">Copied!</div><div class="code_switcher_container_parent 89da1dd8-c2f5-4959-adab-47eab31e2f14"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('89da1dd8-c2f5-4959-adab-47eab31e2f14', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 根据实际情况修改HOST_DIR</span>
docker run <span class="nt">-d</span> <span class="nt">-p</span> 3306:3306 <span class="nt">--privileged</span><span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
    <span class="nt">-v</span> <span class="k">${</span><span class="nv">HOST_DIR</span><span class="k">}</span>/conf:/etc/mysql/conf.d <span class="se">\</span>
    <span class="nt">-v</span> <span class="k">${</span><span class="nv">HOST_DIR</span><span class="k">}</span>/data:/var/lib/mysql <span class="se">\</span>
    <span class="nt">-e</span> <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>root <span class="se">\</span>
    <span class="nt">--name</span> mysql mysql:8.0
</code></pre></div></div>
</div>
<h3 id="section-2">编辑配置文件</h3>
<p>新建配置文件 <code>${HOST_DIR}/conf/my.cnf</code> ，配置字符编码：</p>
<div class="code_switcher_container_parent 3d7a6e0f-bf43-4bfa-97bf-3e6e7eee944b"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('3d7a6e0f-bf43-4bfa-97bf-3e6e7eee944b', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[client]
default_character_set=utf8mb4
[mysqld]
collation_server=utf8mb4_general_ci
character_set_server=utf8mb4
</code></pre></div></div>
</div>
<p>配置完成后，重启容器实例：</p>
<div class="code_switcher_container_parent e969ed40-7656-4f07-a08c-c2850bd3b7c6"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('e969ed40-7656-4f07-a08c-c2850bd3b7c6', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker restart mysql
</code></pre></div></div>
</div>
<h1 id="section-3">主从模式</h1>
<h3 id="section-4">运行主数据库容器实例</h3>
<div class="code_switcher_container_parent 335a4fea-6bd1-4af3-8aca-83a47d6ccce0"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('335a4fea-6bd1-4af3-8aca-83a47d6ccce0', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 根据实际情况修改HOST_DIR</span>
docker run <span class="nt">-d</span> <span class="nt">-p</span> 3307:3306 <span class="nt">--privileged</span><span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
    <span class="nt">-v</span> <span class="k">${</span><span class="nv">HOST_DIR</span><span class="k">}</span>/master/conf:/etc/mysql/conf.d <span class="se">\</span>
    <span class="nt">-v</span> <span class="k">${</span><span class="nv">HOST_DIR</span><span class="k">}</span>/master/data:/var/lib/mysql <span class="se">\</span>
    <span class="nt">-e</span> <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>root <span class="se">\</span>
    <span class="nt">--name</span> mysql-master mysql:8.0
</code></pre></div></div>
</div>
<h3 id="section-5">编辑主数据库配置文件</h3>
<p>新建主数据库配置文件 <code>${HOST_DIR}/master/conf/my.cnf</code> ，配置字符编码和主从同步：</p>
<div class="code_switcher_container_parent dc7f8e04-a925-4797-837c-85644b75ed6d"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('dc7f8e04-a925-4797-837c-85644b75ed6d', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[client]
default_character_set=utf8mb4
[mysqld]
collation_server=utf8mb4_general_ci
character_set_server=utf8mb4

default_authentication_plugin=mysql_native_password

###### 主从配置 ######
## 设置server_id，同一局域网中需要唯一
server_id=101
## 指定不需要同步的数据库名称
binlog-ignore-db=mysql
## 开启二进制日志功能
log-bin=mall-mysql-bin
## 设置二进制日志使用内存大小（事务）
binlog_cache_size=1M
## 设置使用的二进制日志格式（mixed, statement, row）
binlog_format=mixed
## 二进制日志过期清理时间。默认值为0，表示不自动清理。
expire_logs_days=7
## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。
## 如：1062错误表示一些主键重复，1032错误表示主从数据库数据不一致
slave_skip_errors=1062
</code></pre></div></div>
</div>
<p>配置完成后，重启主数据库容器实例：</p>
<div class="code_switcher_container_parent 0f3c6ab0-cde8-45dd-88c4-cdfee942c14c"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('0f3c6ab0-cde8-45dd-88c4-cdfee942c14c', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker restart mysql-master
</code></pre></div></div>
</div>
<h3 id="section-6">在主数据库中创建数据同步用户</h3>
<div class="code_switcher_container_parent 42da5e59-e778-4a0a-9f4e-8a887d9d59bb"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('42da5e59-e778-4a0a-9f4e-8a887d9d59bb', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">USER</span> <span class="s1">'slave'</span><span class="o">@</span><span class="s1">'%'</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">'123456'</span><span class="p">;</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">GRANT</span> <span class="n">REPLICATION</span> <span class="n">SLAVE</span><span class="p">,</span> <span class="n">REPLICATION</span> <span class="n">CLIENT</span> <span class="k">ON</span> <span class="o">*</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">'slave'</span><span class="o">@</span><span class="s1">'%'</span><span class="p">;</span>
</code></pre></div></div>
</div>
<h3 id="section-7">运行从数据库容器实例</h3>
<div class="code_switcher_container_parent d20b9604-757c-4126-9af9-2fd3f33cd0ca"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('d20b9604-757c-4126-9af9-2fd3f33cd0ca', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 根据实际情况修改HOST_DIR</span>
docker run <span class="nt">-d</span> <span class="nt">-p</span> 3308:3306 <span class="nt">--privileged</span><span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
    <span class="nt">-v</span> <span class="k">${</span><span class="nv">HOST_DIR</span><span class="k">}</span>/slave/conf:/etc/mysql/conf.d <span class="se">\</span>
    <span class="nt">-v</span> <span class="k">${</span><span class="nv">HOST_DIR</span><span class="k">}</span>/slave/data:/var/lib/mysql <span class="se">\</span>
    <span class="nt">-e</span> <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>root <span class="se">\</span>
    <span class="nt">--name</span> mysql-slave mysql:8.0
</code></pre></div></div>
</div>
<h3 id="section-8">编辑从数据库配置文件</h3>
<p>新建从数据库配置文件 <code>${HOST_DIR}/slave/conf/my.cnf</code> ，配置字符编码和主从同步：</p>
<div class="code_switcher_container_parent 0fad6128-1826-4538-9a46-85dc715116a9"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('0fad6128-1826-4538-9a46-85dc715116a9', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[client]
default_character_set=utf8mb4
[mysqld]
collation_server=utf8mb4_general_ci
character_set_server=utf8mb4

###### 主从配置 ######
## 设置server_id，同一局域网中需要唯一
server_id=102
## 指定不需要同步的数据库名称
binlog-ignore-db=mysql
## 开启二进制日志功能，以备Slave作为其它数据库实例的Master时使用
log-bin=mall-mysql-slave1-bin
## 设置二进制日志使用内存大小（事务）
binlog_cache_size=1M
## 设置使用的二进制日志格式（mixed, statement, row）
binlog_format=mixed
## 二进制日志过期清理时间。默认值为0，表示不自动清理。
expire_logs_days=7
## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。
## 如：1062错误表示一些主键重复，1032错误表示主从数据库数据不一致
slave_skip_errors=1062
## relay_log配置中继日志
relay_log=mall-mysql-relay-bin
## log_slave_updates表示slave将复制事件写进自己的二进制日志
log_slave_updates=1
## slave设置为只读（具有super权限的用户除外）
read_only=1
</code></pre></div></div>
</div>
<p>配置完成后，重启从数据库容器实例：</p>
<div class="code_switcher_container_parent e5ea974a-411b-4582-b91a-74fc17903ce8"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('e5ea974a-411b-4582-b91a-74fc17903ce8', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker restart mysql-slave
</code></pre></div></div>
</div>
<h3 id="section-9">在主数据库中查看主从同步状态</h3>
<div class="code_switcher_container_parent 9c373518-4bd8-4a14-8be9-490b3c9cfa90"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('9c373518-4bd8-4a14-8be9-490b3c9cfa90', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">show</span> <span class="n">master</span> <span class="n">status</span><span class="p">;</span>
</code></pre></div></div>
</div>
<p><img src="images/docker/docker_run_mysql/show_master_status.png" alt="show_master_status" /></p>
<h3 id="section-10">在从数据库中配置主从同步</h3>
<div class="code_switcher_container_parent 9f19e520-86f4-4d65-adb1-364c398fef4d"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('9f19e520-86f4-4d65-adb1-364c398fef4d', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 根据实际情况修改宿主机IP</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="n">change</span> <span class="n">master</span> <span class="k">to</span> 
    <span class="n">master_host</span><span class="o">=</span><span class="s1">'宿主机IP'</span><span class="p">,</span> <span class="n">master_port</span><span class="o">=</span><span class="mi">3307</span><span class="p">,</span> 
    <span class="n">master_user</span><span class="o">=</span><span class="s1">'slave'</span><span class="p">,</span> <span class="n">master_password</span><span class="o">=</span><span class="s1">'123456'</span><span class="p">,</span> 
    <span class="n">master_log_file</span><span class="o">=</span><span class="s1">'mall-mysql-bin.000003'</span><span class="p">,</span> <span class="n">master_log_pos</span><span class="o">=</span><span class="mi">702</span><span class="p">,</span> 
    <span class="n">master_connect_retry</span><span class="o">=</span><span class="mi">30</span><span class="p">;</span>
</code></pre></div></div>
</div>
<p>参数说明：</p>
<ul>
<li><code>master_host</code>：主数据库的IP地址；</li>
<li><code>master_port</code>：主数据库的运行端口；</li>
<li><code>master_user</code>：在主数据库创建的用于同步数据的用户账号；</li>
<li><code>master_password</code>：在主数据库创建的用于同步数据的用户密码；</li>
<li><code>master_log_file</code>：指定开始复制数据的日志文件，通过查看主数据库的状态，获取<code>File</code>参数；</li>
<li><code>master_log_pos</code>：指定开始复制数据的位置，通过查看主数据库的状态，获取<code>Position</code>参数；</li>
<li><code>master_connect_retry</code>：连接失败重试的时间间隔，单位为秒。</li>
</ul>
<h3 id="section-11">在从数据库中开启主从同步</h3>
<div class="code_switcher_container_parent fa1be92b-6761-4cd4-8252-a90aa701f104"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('fa1be92b-6761-4cd4-8252-a90aa701f104', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">start</span> <span class="n">slave</span><span class="p">;</span>
</code></pre></div></div>
</div>
<h3 id="section-12">在从数据库中查看主从同步状态</h3>
<div class="code_switcher_container_parent 7e22a19e-c0c4-40dd-a5e9-2c6cc148d81c"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('7e22a19e-c0c4-40dd-a5e9-2c6cc148d81c', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">show</span> <span class="n">slave</span> <span class="n">status</span> <span class="err">\</span><span class="k">G</span><span class="p">;</span>
</code></pre></div></div>
</div>
<p><img src="images/docker/docker_run_mysql/show_slave_status.png" alt="show_slave_status" /></p>]]></content><author><name>vveicc</name></author><category term="Docker" /><category term="MySQL" /><summary type="html"><![CDATA[使用 Docker 分别以 单机模式 和 主从模式 运行 MySQL 8.0。]]></summary></entry><entry><title type="html">开发者学习策略</title><link href="https://vveicc.github.io/blog/developer_learning_strategies" rel="alternate" type="text/html" title="开发者学习策略" /><published>2023-02-07T00:00:00+00:00</published><updated>2023-02-07T00:00:00+00:00</updated><id>https://vveicc.github.io/blog/developer_learning_strategies</id><content type="html" xml:base="https://vveicc.github.io/blog/developer_learning_strategies"><![CDATA[<p>作为一名开发者，需要不断学习新技术，跟上现有技术的变化。</p>
<p>学习的过程可能令人兴奋、趣味十足，但也有可能令人沮丧、倍感压力。</p>
<p>因此需要掌握一定的学习策略，帮助我们战胜学习过程中遇到的困难和挑战，这样也就不会那么容易放弃。</p>
<!-- more -->
<h2 id="section">1.接受学习是困难的</h2>
<p>负面情绪往往来自于过高的期望。</p>
<p>如果预期学习比较简单，那么学习过程中的困难和挑战就可能会带给我们更多的沮丧；</p>
<p>如果预期学习比较困难，那么学习过程中的困难和挑战就不太容易让你感到失望、沮丧，因为你已经预料到会很难。</p>
<p>因此，接受学习是困难的，这是一个有效的思维技巧，可以减轻与学习斗争相关的负面情绪。</p>
<p>换句话说，如果你认为生活是艰难的，那么生活就会变得轻松。</p>
<h2 id="section-1">2.导致学习困难的问题</h2>
<p>导致学习困难的问题有很多，其中有一些并不是你的问题。因此在学习过程中遇到困难，不用盲目的责怪自己。</p>
<h3 id="section-2">问题一：糟糕的学习资料</h3>
<p>解决方法：</p>
<ul>
<li><strong>更换学习资料</strong>：找到更易于理解学习的资料</li>
<li><strong>过段时间再来学习这个Topic</strong>：比较新的技术可能当下并没有比较好的学习资料，可以过段时间再来学习</li>
</ul>
<h3 id="section-3">问题二：浮于表象</h3>
<p>解决方法：</p>
<ul>
<li><strong>学习并理解技术原理</strong>：理解是最重要的，而不是翻阅资料</li>
</ul>
<h3 id="section-4">问题三：边学边忘记不住</h3>
<p>解决方法：</p>
<ul>
<li><strong>重复学习直至记住</strong>：提高记忆力最简单的方法之一就是重复</li>
<li><strong>使用高效的记忆技巧</strong>：利用思维导图、技术图表等视觉记忆</li>
<li><strong>练习实践</strong>：学以致用，把所学技术用起来，常用的技术自然容易记住</li>
<li><strong>总结、沉淀、输出</strong>：多总结，将对技术的理解沉淀输出，例如写博客</li>
</ul>
<h3 id="section-5">问题四：疲劳和压力</h3>
<p>解决方法：</p>
<ul>
<li><strong>休息和冷静下来</strong>：对付疲劳和压力的最好办法就是休息，试着让自己冷静下来</li>
<li><strong>一次只做一件事情</strong>：同时做太多的事情会感到压力很大，无法专注且效率低下</li>
<li><strong>专注于此时此刻</strong>：不要因为未来还有很多学不完的技术而感到压力，专注于当下，一步一个脚印的进步</li>
</ul>
<h3 id="section-6">问题五：错误的学习速度</h3>
<p>解决方法：</p>
<ul>
<li><strong>找到适合自己的学习速度</strong>：不同人当前的知识储备不同，学习不同Topic的速度就会有差异</li>
</ul>
<h3 id="section-7">问题六：不知道从哪里开始</h3>
<p>解决方法：</p>
<ul>
<li><strong>使用概览-细节式学习</strong>：先整体后细节，先了解使用后理解细节原理</li>
<li><strong>请教熟悉这个Topic的人</strong>：询问他们从哪里开始，他们在开始学习该技术时做了什么</li>
</ul>]]></content><author><name>vveicc</name></author><category term="Learning" /><summary type="html"><![CDATA[作为一名开发者，需要不断学习新技术，跟上现有技术的变化。 学习的过程可能令人兴奋、趣味十足，但也有可能令人沮丧、倍感压力。 因此需要掌握一定的学习策略，帮助我们战胜学习过程中遇到的困难和挑战，这样也就不会那么容易放弃。]]></summary></entry><entry><title type="html">通过GitHub Actions备份GitHub仓库</title><link href="https://vveicc.github.io/blog/github_mirror" rel="alternate" type="text/html" title="通过GitHub Actions备份GitHub仓库" /><published>2023-02-06T00:00:00+00:00</published><updated>2023-02-06T00:00:00+00:00</updated><id>https://vveicc.github.io/blog/github_mirror</id><content type="html" xml:base="https://vveicc.github.io/blog/github_mirror"><![CDATA[<p>通过GitHub Actions可以方便的将托管在GitHub平台的仓库同步到其他代码托管平台，实现仓库备份。</p>
<p>本文以GitHub仓库同步至Gitee为例，介绍使用<a href="https://github.com/wearerequired/git-mirror-action">git-mirror-action</a>备份GitHub仓库的具体步骤。</p>
<!-- more -->
<h2 id="ssh">1.生成新的SSH密钥</h2>
<p>参考<a href="https://docs.github.com/zh/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent#%E7%94%9F%E6%88%90%E6%96%B0-ssh-%E5%AF%86%E9%92%A5">生成新SSH密钥</a>。
建议使用单独的密钥文件，例如：<code>id_ssh_github_actions</code>。</p>
<h2 id="githubgitee">2.将公钥添加至GitHub和Gitee</h2>
<p>GitHub:<code>Settings</code>-&gt;<code>Access</code>-&gt;<code>SSH and GPG keys</code>-&gt;<code>New SSH key</code></p>
<p>Gitee:<code>设置</code>-&gt;<code>安全设置</code>-&gt;<code>SSH公钥</code></p>
<h2 id="github">3.将私钥添加至GitHub仓库</h2>
<p><code>GitHub仓库</code>-&gt;<code>Settings</code>-&gt;<code>Security</code>-&gt;<code>Secrets and variables</code>-&gt;<code>Actions</code>-&gt;<code>New repository secret</code></p>
<h2 id="github-actions">4.配置GitHub Actions</h2>
<p>在GitHub仓库中添加<code>.github/workflows/sync.yml</code>文件：</p>
<div id="code_copied_snackbar">Copied!</div><div class="code_switcher_container_parent 46e9eeca-8d7f-4426-9204-cca15eba15ca"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('46e9eeca-8d7f-4426-9204-cca15eba15ca', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Sync</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># Triggers the workflow on push event</span>
  <span class="na">push</span><span class="pi">:</span>

  <span class="c1"># Allows you to run this workflow manually from the Actions tab</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>

<span class="c1"># A workflow run is made up of one or more jobs that can run sequentially or in parallel</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">Sync-to-Gitee</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">wearerequired/git-mirror-action@v1.2.0</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">SSH_PRIVATE_KEY</span><span class="pi">:</span> <span class="s">${{ secrets.SSH_PRIVATE_KEY }}</span> <span class="c1"># SSH_PRIVATE_KEY是将私钥添加至GitHub仓库时设置的名称</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">source-repo</span><span class="pi">:</span> <span class="s2">"</span><span class="s">git@github.com:***/***.git"</span>     <span class="c1"># 源仓库SSH URL</span>
          <span class="na">destination-repo</span><span class="pi">:</span> <span class="s2">"</span><span class="s">git@gitee.com:***/***.git"</span> <span class="c1"># 目标仓库SSH URL</span>
</code></pre></div></div>
</div>]]></content><author><name>vveicc</name></author><category term="GitHub Actions" /><category term="git-mirror-action" /><summary type="html"><![CDATA[通过GitHub Actions可以方便的将托管在GitHub平台的仓库同步到其他代码托管平台，实现仓库备份。 本文以GitHub仓库同步至Gitee为例，介绍使用git-mirror-action备份GitHub仓库的具体步骤。]]></summary></entry><entry><title type="html">使用Jekyll搭建GitHub Pages个人博客</title><link href="https://vveicc.github.io/blog/build_blog_tips" rel="alternate" type="text/html" title="使用Jekyll搭建GitHub Pages个人博客" /><published>2023-02-06T00:00:00+00:00</published><updated>2023-02-06T00:00:00+00:00</updated><id>https://vveicc.github.io/blog/build_blog_tips</id><content type="html" xml:base="https://vveicc.github.io/blog/build_blog_tips"><![CDATA[<p>详细步骤可以参考<a href="https://lemonchann.github.io/create_blog_with_github_pages">完整教程</a>，此处只记录一些小问题以及后续操作可能会遇到的点。</p>
<!-- more -->
<h2 id="section">本地调试预览</h2>
<p>首先安装<a href="https://jekyllcn.com">Jekyll</a>，然后在仓库根目录下运行<code>jekyll serve</code>，使用浏览器打开<a href="http://localhost:4000">localhost:4000</a>即可预览。</p>
<h2 id="google-analytics">Google Analytics</h2>
<p><a href="https://analytics.google.com/analytics">Google Analytics</a>已经升级为Google Analytics 4，不过使用起来难度也不大，可以参考<a href="https://skillshop.exceedlms.com/student/path/66749-google-analytics">官方文档</a>学习了解。</p>
<h2 id="latex">支持LaTeX数学公式</h2>
<p>在<code>&lt;head&gt;&lt;/head&gt;</code>标签中引入<a href="https://www.mathjax.org/#gettingstarted">MathJax@3</a>：</p>
<div id="code_copied_snackbar">Copied!</div><div class="code_switcher_container_parent fda103cb-1723-40fb-872e-ddb7079f15ba"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('fda103cb-1723-40fb-872e-ddb7079f15ba', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://polyfill.io/v3/polyfill.min.js?features=es6"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">id=</span><span class="s">"MathJax-script"</span> <span class="na">async</span> <span class="na">src=</span><span class="s">"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div></div>
</div>
<p><a href="https://polyfill.io/v3/">Polyfill</a>的作用是对老浏览器做支持，如果不需要可以不引入。</p>
<p>行内公式配置：</p>
<div class="code_switcher_container_parent 376dc563-629e-4abd-8758-4bdf94df4fa6"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('376dc563-629e-4abd-8758-4bdf94df4fa6', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script&gt;</span>
  <span class="nx">MathJax</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">tex</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">inlineMath</span><span class="p">:</span> <span class="p">[[</span><span class="dl">'</span><span class="s1">$</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">$</span><span class="dl">'</span><span class="p">]],</span>
      <span class="na">processEscapes</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>
</div>
<p>效果展示：</p>
<p>行内公式：$ax^2 + bx + c = 0$</p>
<p>行级公式：</p>
<p>$$
ax^2 + bx + c = 0
$$</p>
<h2 id="codetabs">混合代码段CodeTabs</h2>
<h3 id="section-1">效果展示</h3>
<ul class="code-tab-container f7be43b8-e020-486e-b728-10811bca97e5"><li class="active-tab code_switcher_cpp"><a onclick="selectTab('code_switcher_cpp', 'f7be43b8-e020-486e-b728-10811bca97e5', 0)">C++</a></li><li class=" code_switcher_java"><a onclick="selectTab('code_switcher_java', 'f7be43b8-e020-486e-b728-10811bca97e5', 1)">Java</a></li><li class=" code_switcher_python"><a onclick="selectTab('code_switcher_python', 'f7be43b8-e020-486e-b728-10811bca97e5', 2)">Python3</a></li><li class=" code_switcher_md"><a onclick="selectTab('code_switcher_md', 'f7be43b8-e020-486e-b728-10811bca97e5', 3)">Markdown示例</a></li></ul><ul class="code-tab-switcher f7be43b8-e020-486e-b728-10811bca97e5"><li class="code_switcher_container_parent active-tab code_switcher_cpp 191bfc77-9c71-490d-a97e-ee998204239d"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('191bfc77-9c71-490d-a97e-ee998204239d', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Hello, World!"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</code></pre></div></div>
</li><li class="code_switcher_container_parent code_switcher_java da39e8bc-811d-499e-9801-ed5095c06442"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('da39e8bc-811d-499e-9801-ed5095c06442', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Hello, World!"</span><span class="o">);</span>
</code></pre></div></div>
</li><li class="code_switcher_container_parent code_switcher_python 01aa5cc8-c0dc-402d-b6fa-76c7c0ef5930"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('01aa5cc8-c0dc-402d-b6fa-76c7c0ef5930', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">"Hello, World!"</span><span class="p">)</span>
</code></pre></div></div>
</li><li class="code_switcher_container_parent code_switcher_md 61e2209f-7f93-4757-969d-97e1c8a5bb0d"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('61e2209f-7f93-4757-969d-97e1c8a5bb0d', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="p">```</span><span class="nl">cpp C++
</span><span class="sb">    cout &lt;&lt; "Hello, World!" &lt;&lt; endl;</span>
    <span class="p">```</span>
    
    <span class="p">```</span><span class="nl">java Java
</span><span class="sb">    System.out.println("Hello, World!");</span>
    <span class="p">```</span>
    
    <span class="p">```</span><span class="nl">python Python3
</span><span class="sb">    print("Hello, World!")</span>
    <span class="p">```</span>
</code></pre></div></div>
</li></ul>
<h3 id="section-2">安装插件</h3>
<p>通过<a href="https://rubygems.org/gems/jekyll-commonmark-codetabs">jekyll-commonmark-codetabs</a>插件实现：</p>
<p>在 <code>Gemfile</code> 文件中添加 <code>jekyll-commonmark-codetabs</code> gem：</p>
<div class="code_switcher_container_parent 095df978-7c17-44a6-97e6-6b35375c7856"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('095df978-7c17-44a6-97e6-6b35375c7856', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">group</span> <span class="ss">:jekyll_plugins</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'jekyll-commonmark-codetabs'</span>
<span class="k">end</span>
</code></pre></div></div>
</div>
<p>在 <code>_config.yml</code> 文件中配置 Markdown 解析器：</p>
<div class="code_switcher_container_parent 5f30b383-f6ab-43ca-b514-4e3c5d4c9133"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('5f30b383-f6ab-43ca-b514-4e3c5d4c9133', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">markdown</span><span class="pi">:</span> <span class="s">CommonMarkCodeTabs</span>
</code></pre></div></div>
</div>
<p>jekyll-commonmark-codetabs插件基于<a href="https://rubygems.org/gems/jekyll-commonmark-ghpages">jekyll-commonmark-ghpages</a>，可以直接进行配置，示例：</p>
<div class="code_switcher_container_parent 1eb05285-fdc3-4962-9fb6-d13e8fb3906b"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('1eb05285-fdc3-4962-9fb6-d13e8fb3906b', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">commonmark</span><span class="pi">:</span>
  <span class="na">options</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">SMART"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">FOOTNOTES"</span><span class="pi">]</span>
  <span class="na">extensions</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">strikethrough"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">autolink"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">table"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">tagfilter"</span><span class="pi">]</span>
</code></pre></div></div>
</div>
<p>执行命令安装插件：</p>
<div class="code_switcher_container_parent 825f6938-8be2-480d-aa36-887c99a247dd"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('825f6938-8be2-480d-aa36-887c99a247dd', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle config <span class="nb">set</span> <span class="nt">--local</span> path <span class="s1">'vendor/bundle'</span>
bundle <span class="nb">install</span>
</code></pre></div></div>
</div>
<h3 id="section-3">本地调试</h3>
<p>在仓库根目录下运行<code>bundle exec jekyll serve</code>。</p>
<h3 id="github-pages">通过GitHub Pages发布</h3>
<p>GitHub Pages仅默认支持一小部分Jekyll插件，需要通过GitHub Actions根据 <code>Gemfile</code> 文件安装插件并构建推送至<code>gh-pages</code>分支，再通过GitHub Pages从<code>gh-pages</code>分支部署。</p>
<p>在GitHub仓库中添加<code>.github/workflows/jekyll-gh-pages.yml</code>文件：</p>
<div class="code_switcher_container_parent 2650da8b-b7d1-4499-9d2a-1687b54414d1"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('2650da8b-b7d1-4499-9d2a-1687b54414d1', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Building and publishing a Jekyll site to branch gh-pages</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">jekyll-gh-pages</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="c1"># Runs on pushes targeting the default branch</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span> <span class="s2">"</span><span class="s">main"</span> <span class="pi">]</span>

  <span class="c1"># Allows you to run this workflow manually from the Actions tab</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>

<span class="c1"># Allow one concurrent deployment</span>
<span class="na">concurrency</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s2">"</span><span class="s">pages"</span>
  <span class="na">cancel-in-progress</span><span class="pi">:</span> <span class="no">true</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">jekyll</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>

      <span class="c1"># Build &amp; Publish</span>
      <span class="c1"># Use GitHub Actions' cache to shorten build times and decrease load on servers</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/cache@v2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">vendor/bundle</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">${{ runner.os }}-gems-${{ hashFiles('**/Gemfile') }}</span>
          <span class="na">restore-keys</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">${{ runner.os }}-gems-</span>

      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">helaili/jekyll-action@v2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">token</span><span class="pi">:</span> <span class="s">${{ secrets.PUBLISH_TOKEN }}</span> <span class="c1"># 需要申请GitHub Access Token并添加至GitHub仓库Secrets中</span>
          <span class="na">target_branch</span><span class="pi">:</span> <span class="s1">'</span><span class="s">gh-pages'</span>
</code></pre></div></div>
</div>
<p>如果在GitHub Actions运行过程中遇到如下报错：</p>
<div class="code_switcher_container_parent d6e43796-ef51-4e12-a715-b2695f8afe80"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('d6e43796-ef51-4e12-a715-b2695f8afe80', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sass-embedded-1.58.3-x86_64-linux-musl requires rubygems version &gt;= 3.3.22,
which is incompatible with the current version, 3.1.6
</code></pre></div></div>
</div>
<p>可以尝试在 <code>Gemfile</code> 文件中设置旧版本的sass转换器来解决：</p>
<div class="code_switcher_container_parent 0a3c1466-804d-42c3-aae9-06ab12feca52"><div class="code_switcher_code_action_container"><button id="code_switcher_copy_button" class="code_switcher_copy_button" title="Copy" onclick="copyText('0a3c1466-804d-42c3-aae9-06ab12feca52', '')"></button><button class="code_switcher_theme_button" onclick="updateTheme(true)"></button></div>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gem</span> <span class="s2">"jekyll-sass-converter"</span><span class="p">,</span> <span class="s2">"~&gt; 2.0"</span>
</code></pre></div></div>
</div>]]></content><author><name>vveicc</name></author><category term="GitHub Pages" /><summary type="html"><![CDATA[详细步骤可以参考完整教程，此处只记录一些小问题以及后续操作可能会遇到的点。]]></summary></entry></feed>